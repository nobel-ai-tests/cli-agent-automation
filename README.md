# Gemini CLI Agent Automation

An advanced orchestrator for running multiple Gemini CLI agents in parallel with real-time tracking, automated post-mortems, adaptive throttling, and a self-learning loop.

## Table of Contents
1. [Overview](#overview)
2. [Key Features](#key-features)
3. [Architecture](#architecture)
4. [Components](#components)
    - [The Controller](#the-controller)
    - [The Critic Agent](#the-critic-agent)
    - [Web Dashboard](#web-dashboard)
5. [Installation](#installation)
6. [Usage](#usage)
7. [Self-Learning Loop](#self-learning-loop)
8. [Skill Integration](#skill-integration)

---

## Overview
This project provides a robust framework for automating complex software engineering tasks using the Gemini CLI. It allows users to define multiple tasks, execute them in isolated environments, and automatically learn from the outcomes to improve future performance through a closed-loop feedback system.

## Key Features
- **Parallel Execution:** Run multiple agents simultaneously with configurable worker limits.
- **Adaptive Throttling:** Automatically reduces concurrency when API rate limits (429) are detected to maximize throughput without exhaustion.
- **Integrity-Based Completion:** Detects task success by verifying the output files (e.g., `index.html`), allowing projects to be marked "Done" even if an agent process is interrupted by a quota limit or timeout.
- **Auto-Resumption:** Context-aware resumption that reads existing files and plans before continuing work on interrupted tasks.
- **Atomic Reliability:** Uses atomic file operations to prevent data corruption during high-concurrency logging or manifest updates.
- **Real-time Monitoring:** Monolithic progress tracking via a terminal-based dashboard (`rich`) and a web-based results explorer.

## Architecture
The system is built for robustness and persistence:
- **Isolation:** Each project runs in its own subdirectory under `projects/`.
- **Throttling:** A dynamic semaphore-based concurrency control system.
- **Telemetry:** JSON-structured logging in `controller.log` for machine readability and analysis.
- **Repair:** Post-mortem logic that can retrospectively repair project states.

## Components

### The Controller (`controller.py`)
The orchestrator. It manages the project lifecycle:
1. **Initialize:** Loads `projects.json` and sets up the execution environment.
2. **Execute:** Spawns sub-processes with injected "System Guidelines" and "Learned Lessons".
3. **Monitor:** Parses STDOUT for progress steps and STDERR for rate limits.
4. **Verify:** Performs integrity checks on project outputs to ensure success.

### The Critic Agent (`critic_agent.py`)
The brain of the self-learning loop. It:
1. **Parses Telemetry:** Analyzes JSON logs for repetitive errors or "thought loops".
2. **Validates Integrity:** Inspects every project directory for valid code and documentation.
3. **Repairs State:** Automatically marks projects as `.done` if they pass validation but were interrupted.
4. **Synthesizes Lessons:** Uses Gemini to identify why failures occurred and updates `subagent_instructions.txt`.

### Web Dashboard (`index.html`)
A static dashboard that visualizes the state of the `projects/` directory. It uses `projects_manifest.json` (generated by `generate_manifest.py`) to provide a browsable interface for all generated assets.

## Installation

### Prerequisites
- Python 3.8+
- [Gemini CLI](https://github.com/google/gemini-cli)
- Rich Library (`pip install rich`)

### Setup
1. Clone the repository:
   ```bash
   git clone <repository-url>
   cd cli-agent-automation
   ```
2. Install dependencies:
   ```bash
   pip install -r requirements.txt
   ```

## Usage

### Running the Controller
Execute all projects defined in `projects.json`:
```bash
python3 controller.py --max-workers 4
```

### Updating the Dashboard
If you've added new projects or modified existing ones, update the web manifest:
```bash
python3 generate_manifest.py
```

## Self-Learning Loop
The loop is fully automated. Every run of the controller concludes with a call to the Critic Agent. This ensures that every failure is analyzed and converted into a persistent instruction for the next generation of agents.

## Skill Integration
The "Parallel Orchestrator Learning" workflow is encapsulated in a Gemini CLI skill.
Activate it for expert guidance:
```bash
activate_skill("parallel-orchestrator-learning")
```

---
*Created by Gemini CLI*